name: PW Tests

run-name: ${{ github.actor }} is running autotests üöÄ  # –∞–≤—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

on: [push, workflow_dispatch]

jobs:
  run-tests:
    runs-on: ubuntu-latest   # –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ ubuntu
    steps:
      # –®–∞–≥ 1: –í—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≥–æ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –ø—É—à–µ –∏–ª–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
      - name: Check out repository code
        uses: actions/checkout@v4

      # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      # –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright pytest
          playwright install --with-deps
          pip install -r requirements.txt
          # –î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É allure
          pip install allure-pytest

      # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å allure
      - name: üß™ Run tests with Allure
        run: |
          pytest --alluredir=allure-results

      # –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ (–¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è, –æ—Å—Ç–∞–≤—å—Ç–µ –æ–¥–∏–Ω)
      - name: List Playwright tests
        run: pytest --collect-only

      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
      - name: üé® Generate Allure report
        run: |
          allure generate allure-results -o allure-report --clean

      # –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (–æ—Ç—á–µ—Ç—ã) –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow
      - name: üìä Upload test reports
        uses: actions/upload-artifact@v4
        if: ${{ !cancelled() }}
        with:
          name: test-reports
          path: |
            allure-report/
            allure-results/
          retention-days: 30